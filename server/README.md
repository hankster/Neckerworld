# Neckerworld - A Computer Vision Game

![Neckerworld server diagram](../images/Neckerworld-server.png)

## Overview

The "server" directory contains all the software and components needed to create the playing field server.
The "cube" program is the runtime server and uses opengl to render images of the playing field.
It's started by running a command with a JSON file argument describing the window and ground textures:

```
./cube ../setup/nw.json
./cube ../setup/nwtest.json <--- Default game for testing and experimentation
```
This launches the game.
Port 2020 is opened up for receipt of messages from client players.

An extremely important, fundamental, task which the server rendering engine (cube_engine.cpp) performs is to generate a "cube's-eye" view of the playing field.
Each cube player will be continually requesting visual updates of their view of the Neckerworld.
These views are the only source of information about the playing field for each cube and the view for each and every cube is different (different location, angle, perspective, etc.).
A cube does not have any access to the overhead camera view of the entire field.
Once one or more cubes request a cube's-eye view, the server starts to render the multiple views for each player.
These private views are continually changing as the cube moves around and other objects (mates, predators, resources) alter their position or existence.
For each frame the server first renders the overhead camera view of the playing field and then steps through and renders the view for each cube.
The privately rendered cube views are passed independently to each requesting cube via the messaging protocol.

In the display window generated by the server the overhead camera view is generated when the server starts.
The views of the playing field from the cube's point of view are displayed on the left-hand panel of ../client/nwplay.py.

## Summary of programs

### cube.cpp

This is the main C++ program and starts all activity.
See file "cube-keys.txt" for command codes that may be used (while focus is in the server display window).

### cube_data.cpp

Accepts and decodes JSON files to create data structures for the playing field.

### cube_engine.cpp

Contains the main display loop to render objects in opengl.

### cube_objects.cpp

Processes all requests for playing field objects.
Moves and rotates cubees as requested.
Checks for contact and conflicts in cube positions.
Changes camera and light positions.
Handles ground motions and positions.

### cube_simulation.cpp

Accepts incoming JSON messages from all clients and intrprets them.
Responds to clients with a JSON message update.

### cube.f.glsl

An opengl shader program.

### cube.v.glsl

An opengl shader program.

## Installation

Follow these steps to create and install the game server:
```
# Compile the multi-thread server code
cd ~/Neckerworld/server/mtserver/mtserver
make
cd ~/Neckerworld/server
make
# Start the server with a playing-field file
./cube ~/Neckerworld/setup/nwtest.json
# To activate predators on the playing field select the server window and type "S"
# This will enable the server's basic strategy (control of predators and resources).
# To put all cubes in motion for a game simulation also press "E".
# Type "?" for a full list of server keyboard controls.
```

